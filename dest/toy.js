!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Toy=e()}(this,function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),i=0,o=function(){function t(){e(this,t),this.uid=i++,this.subs=[]}return n(t,[{key:"addSub",value:function(t){this.subs.push(t)}},{key:"notify",value:function(){this.subs.forEach(function(t){t.update()})}}]),t}();o.target=null;var u=function(e){e&&"object"===("undefined"==typeof e?"undefined":t(e))&&new a(e)},a=function(){function t(n){e(this,t),this.walk(n)}return n(t,[{key:"walk",value:function(t){var e=this;Object.keys(t).forEach(function(n){e.defineReactive(t,n,t[n])})}},{key:"defineReactive",value:function(t,e,n){var i=new o;u(n),Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:function(){return o.target&&o.target.addDep(i),n},set:function(t){t!==n&&(n=t,u(t),i.notify())}})}}]),t}(),r=function(){function t(n,i,o){e(this,t),this.vm=n,this.exp=i,this.cb=o,this.deps={},this.value=this.get()}return n(t,[{key:"get",value:function(){o.target=this;var t=this.getVmValue();return o.target=null,t}},{key:"update",value:function(){var t=this.value,e=this.get();this.cb.call(this.vm,e,t)}},{key:"addDep",value:function(t){this.deps.hasOwnProperty(t.uid)||(t.addSub(this),this.deps[t.uid]=t)}},{key:"getVmValue",value:function(){var t=this.exp.split("."),e=this.vm._data;return t.forEach(function(t){e=e[t]}),e}}]),t}(),c=/\{\{(.*)\}\}/,s={text:function(t,e){t.textContent=void 0===e?"":e},html:function(t,e){t.innerHTML=void 0===e?"":e},model:function(t,e){t.value=void 0===e?"":e}},f={bind:function(t,e,n,i){var o=s[i];o&&o(t,this._getVmVal(e,n)),new r(e,n,function(e,n){o&&o(t,e,n)})},text:function(t,e,n){this.bind(t,e,n,"text")},html:function(t,e,n){this.bind(t,e,n,"html")},model:function(t,e,n){this.bind(t,e,n,"model");var i=this,o=this._getVmVal(e,n);t.addEventListener("input",function(t){var u=t.target.value;u!==o&&(i._setVmVal(e,n,u),o=u)})},eventHandle:function(t,e,n,i){var o=i.split(":")[1],u=e.$options.methods&&e.$options.methods[n];o&&u&&t.addEventListener(o,u.bind(e),!1)},_getVmVal:function(t,e){var n=e.split("."),i=t._data;return n.forEach(function(t){i=i[t]}),i},_setVmVal:function(t,e,n){var i=e.split("."),o=t._data;i.forEach(function(t,e){e<i.length-1&&(o=o[t]),o[t]=n})}},l=function(){function t(n,i){e(this,t),this.$vm=i;var o=this.isElement(n)?n:document.querySelector(n);if(o){var u=this.node2Fragment(o);this.compileElement(u),o.appendChild(u)}}return n(t,[{key:"isElement",value:function(t){return 1===t.nodeType}},{key:"isTextNode",value:function(t){return 3===t.nodeType}},{key:"node2Fragment",value:function(t){for(var e=document.createDocumentFragment(),n=void 0;n=t.firstChild;)e.appendChild(n);return e}},{key:"compileElement",value:function(t){var e=this,n=t.childNodes;Array.prototype.slice.call(n).forEach(function(t){var n=t.textContent;e.isElement(t)?e.compile(t):e.isTextNode&&c.test(n)&&e.compileText(t,RegExp.$1),t.childNodes&&t.childNodes.length&&e.compileElement(t)})}},{key:"compile",value:function(t){var e=this,n=t.attributes;Array.prototype.slice.call(n).forEach(function(n){if(e.isDirective(n.name)){var i=n.value,o=n.name.substring(2);e.isEventDirective(o)?f.eventHandle(t,e.$vm,i,o):f[o]&&f[o](t,e.$vm,i)}})}},{key:"compileText",value:function(t,e){f.text(t,this.$vm,e)}},{key:"isDirective",value:function(t){return/^v-.*/.test(t)}},{key:"isEventDirective",value:function(t){return/^on.*/.test(t)}}]),t}(),d=function(){function t(n){e(this,t);var i=this;i.$options=n,i._data=n.data,Object.keys(i._data).forEach(function(t){i._proxy(t)}),u(i._data),new l(i.$options.el,i)}return n(t,[{key:"_proxy",value:function(t){var e=this;Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:function(){return e._data[t]},set:function(n){e._data[t]=n}})}},{key:"$watch",value:function(t,e){new r(this,t,e)}}]),t}();return d});
